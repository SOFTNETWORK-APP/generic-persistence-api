<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="505px" preserveAspectRatio="none" style="width:895px;height:505px;background:#FFFFFF;" version="1.1" viewBox="0 0 895 505" width="895px" zoomAndPan="magnify"><defs/><g><rect fill="#EDEDED" height="486.125" style="stroke:#181818;stroke-width:0.5;" width="122" x="16" y="6"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="298" y="314.8828"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="359" y="176.4199"/><rect fill="#FFFFFF" height="347.0156" style="stroke:#181818;stroke-width:1.0;" width="10" x="597" y="142.1094"/><rect fill="#FFFFFF" height="77.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="602" y="395.5039"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="840" y="429.8145"/><rect fill="none" height="231.084" style="stroke:#000000;stroke-width:1.5;" width="879.5" x="10" y="250.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="77" x2="77" y1="67.4883" y2="498.125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="302.5" x2="302.5" y1="67.4883" y2="498.125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="363.5" x2="363.5" y1="67.4883" y2="498.125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="602" x2="602" y1="67.4883" y2="498.125"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="844.5" x2="844.5" y1="67.4883" y2="498.125"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="108" x="20" y="64.5352">CQRS write side</text><path d="M56.5,23 L56.5,47 M56.5,35 L73.5,35 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><ellipse cx="85.5" cy="35" fill="#E3E3E3" rx="12" ry="12" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="49" x="275.5" y="64.5352">Journal</text><path d="M285,15 C285,5 303,5 303,5 C303,5 321,5 321,15 L321,41 C321,51 303,51 303,51 C303,51 285,51 285,41 L285,15 " fill="#E3E3E3" style="stroke:#181818;stroke-width:1.5;"/><path d="M285,15 C285,25 303,25 303,25 C303,25 321,25 321,15 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="41" x="340.5" y="64.5352">Offset</text><path d="M346,15 C346,5 364,5 364,5 C364,5 382,5 382,15 L382,41 C382,51 364,51 364,51 C364,51 346,51 346,41 L346,15 " fill="#E3E3E3" style="stroke:#181818;stroke-width:1.5;"/><path d="M346,15 C346,25 364,25 364,25 C364,25 382,25 382,15 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E3E3E3" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="174" x="515" y="36"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="160" x="522" y="56.5352">Event Processor Stream</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="63" x="810.5" y="64.5352">Query DB</text><path d="M827,15 C827,5 845,5 845,5 C845,5 863,5 863,15 L863,41 C863,51 845,51 845,51 C845,51 827,51 827,41 L827,15 " fill="#E3E3E3" style="stroke:#181818;stroke-width:1.5;"/><path d="M827,15 C827,25 845,25 845,25 C845,25 863,25 863,15 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="298" y="314.8828"/><rect fill="#FFFFFF" height="29.3105" style="stroke:#181818;stroke-width:1.0;" width="10" x="359" y="176.4199"/><rect fill="#FFFFFF" height="347.0156" style="stroke:#181818;stroke-width:1.0;" width="10" x="597" y="142.1094"/><rect fill="#FFFFFF" height="77.6211" style="stroke:#181818;stroke-width:1.0;" width="10" x="602" y="395.5039"/><rect fill="#FFFFFF" height="14" style="stroke:#181818;stroke-width:1.0;" width="10" x="840" y="429.8145"/><path d="M607,82.4883 L607,107.4883 L799,107.4883 L799,92.4883 L789,82.4883 L607,82.4883 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><path d="M789,82.4883 L789,92.4883 L799,92.4883 L789,82.4883 " fill="#FAFAFA" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="613" y="100.0566">tag = 'domain-to-external'</text><line style="stroke:#181818;stroke-width:1.0;" x1="602" x2="649" y1="129.1094" y2="129.1094"/><line style="stroke:#181818;stroke-width:1.0;" x1="649" x2="649" y1="129.1094" y2="142.1094"/><line style="stroke:#181818;stroke-width:1.0;" x1="608" x2="649" y1="142.1094" y2="142.1094"/><polygon fill="#181818" points="618,138.1094,608,142.1094,618,146.1094,614,142.1094" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="21" x="614" y="124.3672">init</text><polygon fill="#181818" points="380,172.4199,370,176.4199,380,180.4199,376,176.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="374" x2="596" y1="176.4199" y2="176.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="74" x="446" y="171.6777">readOffset()</text><polygon fill="#181818" points="585,201.7305,595,205.7305,585,209.7305,589,205.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="364" x2="591" y1="205.7305" y2="205.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="38" x="461.5" y="200.9883">offset</text><polygon fill="#181818" points="314,231.041,304,235.041,314,239.041,310,235.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="308" x2="596" y1="235.041" y2="235.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="359.5" y="230.2988">readEventsByTag(</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="22" x="468.5" y="230.2988">tag</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="490.5" y="230.2988">,</text><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="38" x="498.5" y="230.2988">offset</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="4" x="536.5" y="230.2988">)</text><path d="M10,250.041 L84,250.041 L84,257.3516 L74,267.3516 L10,267.3516 L10,250.041 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.5;"/><rect fill="none" height="231.084" style="stroke:#000000;stroke-width:1.5;" width="879.5" x="10" y="250.041"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="29" x="25" y="263.6094">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="4" x="99" y="262.6758">[</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="38" x="103" y="262.6758">stream</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="247" x="145" y="262.6758">of events with the tag "domain-to-external"</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="174" x="99" y="275.6309">starting at the specified offset]</text><polygon fill="#181818" points="286,310.8828,296,314.8828,286,318.8828,290,314.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="77" x2="292" y1="314.8828" y2="314.8828"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="86.5" y="294.8301">persist domain event with tag(s)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184" x="97.5" y="310.1406">Set("domain-to-external", ...)</text><polygon fill="#181818" points="88,324.8828,78,328.8828,88,332.8828,84,328.8828" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="82" x2="302" y1="328.8828" y2="328.8828"/><line style="stroke:#181818;stroke-width:1.0;" x1="595" x2="585" y1="358.1934" y2="354.1934"/><line style="stroke:#181818;stroke-width:1.0;" x1="595" x2="585" y1="358.1934" y2="362.1934"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="303" x2="596" y1="358.1934" y2="358.1934"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="405" y="353.4512">eventEnvelope</text><line style="stroke:#181818;stroke-width:1.0;" x1="607" x2="654" y1="382.5039" y2="382.5039"/><line style="stroke:#181818;stroke-width:1.0;" x1="654" x2="654" y1="382.5039" y2="395.5039"/><line style="stroke:#181818;stroke-width:1.0;" x1="613" x2="654" y1="395.5039" y2="395.5039"/><polygon fill="#181818" points="623,391.5039,613,395.5039,623,399.5039,619,395.5039" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="619" y="377.7617">processEvent(eventEnvelope.event)</text><polygon fill="#181818" points="828,425.8145,838,429.8145,828,433.8145,832,429.8145" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="612" x2="834" y1="429.8145" y2="429.8145"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="31" x="710.5" y="425.0723">write</text><polygon fill="#181818" points="623,439.8145,613,443.8145,623,447.8145,619,443.8145" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="617" x2="844" y1="443.8145" y2="443.8145"/><polygon fill="#181818" points="375,469.125,365,473.125,375,477.125,371,473.125" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="369" x2="596" y1="473.125" y2="473.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="376" y="468.3828">writeOffset(eventEnvelope.offset)</text><!--MD5=[d5b2a0915929108e25dfb61febd0fe38]
@startuml CQRS-read-side
hide footbox
skinparam ParticipantPadding 20
skinparam BoxPadding 10
skinparam sequenceMessageAlign center
skinparam monochrome true

box#AntiqueWhite
boundary "CQRS write side" as ebc
end box

database Journal as j
database Offset as o
participant "Event Processor Stream" as eps
note right of eps : tag = 'domain-to-external'
database "Query DB" as q

eps -> eps++: init
eps -> o++: readOffset()
return **offset**
eps -> j: readEventsByTag(**tag**, **offset**)

loop **stream** of events with the tag "domain-to-external" \nstarting at the specified offset
ebc -> j++: persist domain event with tag(s)\n Set("domain-to-external", ...)
return

j - ->> eps: eventEnvelope
eps -> eps++: processEvent(eventEnvelope.event)
eps -> q++ : write
return
eps - -> o- - :writeOffset(eventEnvelope.offset)

end
@enduml

PlantUML version 1.2022.12(Sun Oct 23 20:12:26 CEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: fr
Country: FR
--></g></svg>